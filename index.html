<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Title</title>

  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/image.css">


  <!-- JQuery-->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script src="/js/jquery.twbsPagination.js"></script> <!-- jQuery -->
  <script src="/js/jquery-3.6.0.min.js"></script> <!-- Bootstrap -->
  <script src="/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="/css/bootstrap.min.css"/>

<!--  <style>-->
<!--    @font-face {-->
<!--      font-family: 'IM_Hyemin-Bold';-->
<!--      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2106@1.1/IM_Hyemin-Bold.woff2') format('woff');-->
<!--      font-weight: normal;-->
<!--      font-style: normal;-->
<!--    }-->

<!--    *{-->
<!--      font-family: 'IM_Hyemin-Bold'; !important;-->
<!--    }-->
<!--  </style>-->


</head>

<script>

  // let apiUrl = "http://heartmuscle-env.eba-v2mbdfk2.ap-northeast-2.elasticbeanstalk.com"
  // let apiUrl = "http://localhost:8080"
  let apiUrl = "https://www.heartmusclebackend.shop"

  $(document).ready(function () {
      login_check();
      feed_list();
  });

  function login_check(){
      let check_token = localStorage.getItem('token')
      if (check_token == null) {
          alert("로그인부터!")
          history.pushState(null, null, '/push')
          window.location.href="login.html"
      }
  }

  function feed_list() {

    $('#post').empty();

    $.ajax({
      type: "GET",
      url: apiUrl + `/feed`,
      success: function (response) {
        console.log(response)

        for (let i = 0; i < response.length; i++) {
          let title = response[i]['title']
          let id = response[i]['id']
          let url = response[i]['imageUrl']
          let createdAt = response[i]['createdAt']
          let username = response[i]['username']
          console.log(id)

          let tempHtml = `
                                    <article class="contents">
                                        <div class="img_section">
                                            <div class="trans_inner">
                                                <div><a onclick="getDetail('${id}')"><img src="${url}" class="card-img-top image-size" alt="..."></a></div>
                                            </div>
                                        </div>

                                        <div class="comment_container">
                                            <div class="comment" id="comment-list-ajax-post37">
                                                <div class="comment-detail">
                                                    <div class="title"><a href="profile.html?id=${username}">${username}</a></div>
                                                    <div class="title">${title}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </article>
                                    `

          $('#feed').append(tempHtml)
        }
      }
    })
  }

  // function getTime(createAt) {
  //   let today = new Date()
  //   var hours = ('0' + today.getHours()).slice(-2);
  //   var minutes = ('0' + today.getMinutes()).slice(-2);
  //   var seconds = ('0' + today.getSeconds()).slice(-2);
  //
  //   var timeString = hours + ':' + minutes  + ':' + seconds;
  //
  //   console.log(timeString)
  //   console.log(createAt)
  //   // console.log(today.toLocaleTimeString())
  //   // let time = today - createAt;
  //   console.log(today)
  // }

  // window.pagObj = $('#pagination').twbsPagination({
  //   totalPages: [[${dataListPage.totalPages}]],
  //   startPage: parseInt([[${dataListPage.number}]] + 1),
  //   visiblePages: 2,
  //   prev: "‹",
  //   next: "›",
  //   first: '«',
  //   last: '»',
  //   onPageClick: function (event, page) {
  //     console.info("current page : " + page);
  //   }
  // }).on('page', function (event, page) {
  //   searchDataList(page);
  // });


  function mypage() {
    username = localStorage.getItem('username')
    console.log(username)
    window.location.href = 'profile.html?id=' + username
  }

  function getDetail(id) {
    console.log('id', id)
    window.location.href = 'feed-detail.html?id=' + id
  }

</script>
<body>


<section id="container">


  <header id="header">
    <section class="h_inner">
      <a href="index.html">
        <div>
          <img src="imgs/logo.png">
        </div>
      </a>
      <div class="right_icons">
        <a href="feed-save.html"><div class="sprite_plus_icon"></div></a>
        <a href="qna-list.html"><div class="sprite_bubble_icon"></div></a>
        <a href="login.html"><div class="sprite_compass_icon"></div></a>
        <a onclick="mypage()"><div class="sprite_user_icon_outline"></div></a>
      </div>
    </section>
  </header>

  <section id="main_container">
    <div>

      <div class="contents_box" id="feed">
      </div>

      <input type="hidden" id="page" value="1">

    </div>
  </section>



</section>








<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="js/main.js"></script>
</body>
</html>